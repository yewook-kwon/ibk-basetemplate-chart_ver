<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>환율 차트</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f4f4f4;
    }
    canvas {
      background: white;
      border: 1px solid #ccc;
    }
    .tooltip {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid #ccc;
      padding: 8px;
      border-radius: 4px;
      pointer-events: none;
      display: none; /* Initially hidden */
      transition: display 0.2s;
    }
  </style>
</head>
<body>
<canvas id="exchangeRateChart" width="800" height="400"></canvas>
<div class="tooltip" id="tooltip"></div>

<script>
  const ctx = document.getElementById('exchangeRateChart').getContext('2d');
  const tooltip = document.getElementById('tooltip');

  const generateDates = () => {
    const dates = [];
    const today = new Date();
    const threeMonthsAgo = new Date();
    threeMonthsAgo.setMonth(today.getMonth() - 3);

    for (let d = threeMonthsAgo; d <= today; d.setDate(d.getDate() + 1)) {
      dates.push(`${String(d.getMonth() + 1).padStart(2, '0')}/${String(d.getDate()).padStart(2, '0')}`);
    }
    return dates;
  };

  dates =['4/15', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '5/13', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '6/12', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '7/12']

  const a = new Array(1371.60,1383.70,1395.30,1386.30,1375.90,1385.00,1380.60,1377.90,1370.00,1376.60,1375.90,1378.70,1378.00,1378.50,1365.20,1357.80,1364.40,1367.90,1367.90,1370.10,1369.00,1349.40,1355.20,1356.20,1364.40,1363.10,1364.50,1370.00,1365.40,1359.50,1364.80,1376.50,1381.60,1377.60,1373.10,1371.50,1366.90,1377.90,1377.40,1377.80,1371.00,1377.70,1380.40,1380.50,1380.80,1383.80,1389.10,1389.70,1386.40,1390.10,1389.20,1382.40,1380.80,1387.40,1389.40,1381.90,1379.00,1379.40,1383.40,1385.60,1380.10);

  const exchangeRates = a;
  //Array.from({ length: dates.length }, () => Math.floor(Math.random() * (1230 - 1150 + 1)) + 1150);

  var gradient = ctx.createLinearGradient(0, 0, 0, 590);
  gradient.addColorStop(0, 'rgba(0, 40, 140, 1.0)');
  gradient.addColorStop(1, 'rgba(0, 40, 140, 0.3)');

  const exchangeRateData = {
    labels: dates,
    datasets: [{
      label: '환율 (USD/KRW)',
      data: exchangeRates,
      borderColor: 'rgba(0, 40, 140, 1)',
      backgroundColor: gradient,
      borderWidth: 2,
      fill: true,
      tension: 0.4,
      pointRadius: 0
    }]
  };

  const config = {
    type: 'line',
    data: exchangeRateData,
    options: {
      responsive: true,
      plugins: {
        legend: {
          display: false // legend 숨기기
        },
        tooltip: {
          enabled: false // 기본 툴팁 비활성화
        },
      },
      interaction: {
        mode: 'index',
        intersect: false
      },
      scales: {
        x: {
          title: {
            display: false,
            text: '날짜 (월/일)',
          },
          grid: {
            display: false
          }
        },
        y: {
          title: {
            display: false,
            text: '환율 (KRW)',
          },
          suggestedMax: 1410,
          beginAtZero: false,
          grid: {
            color: 'rgba(200, 200, 200, 0.8)',
          }
        }
      }
    }
  };

  const exchangeRateChart = new Chart(ctx, config);

  const getDateIndex = (dateString) => {
    console.log(dates.findIndex(date => date === dateString));
    return dates.findIndex(date => date === dateString);
  };

  const showTooltipsForDates = (dateIndices) => {
    const colors = ['rgb(255, 99, 132)', 'rgb(54, 162, 235)', 'rgb(255, 206, 86)']; // Array of RGB colors
    dateIndices.forEach((dateIndex,i) => {
      if (dateIndex !== -1) {
        const dataPoint = exchangeRateData.datasets[0].data[dateIndex];

        const x = ctx.canvas.offsetLeft + (dateIndex + 0.5) * (ctx.canvas.width / exchangeRateData.labels.length);
        const y = ctx.canvas.offsetTop + (1 - (dataPoint - Math.min(...exchangeRates)) / (Math.max(...exchangeRates) - Math.min(...exchangeRates))) * ctx.canvas.height;

        const tooltipClone = tooltip.cloneNode(true);
        tooltipClone.innerHTML = `${dataPoint}`;
        tooltipClone.style.display = 'block';
        tooltipClone.style.backgroundColor = colors[i % colors.length];
        tooltipClone.style.left = `${x}px`;
        tooltipClone.style.top = `${y - 30}px`;
        document.body.appendChild(tooltipClone);
      }
    });
  };

  const desiredDates = ["4/15", "5/13"];
  const desiredDateIndices = desiredDates.map(getDateIndex);
  showTooltipsForDates(desiredDateIndices);

</script>
</body>
</html>
